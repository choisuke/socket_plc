# socket_plc

## Contents

### plc_connect.py

PLCとデータを授受するプログラム

#### function

|名称|概要|引数|
|:---|:---|:---|
|read|指定されたデバイスの値を取得する|デバイス番号. 読み込むデータの長さ|
|write|指定されたデバイスに対して、値を書き込む|デバイス番号, 書き込むデータ|
|send|PLCに対してコマンドを送信する|コマンド|
|recv|PLCの応答を受け取る|なし|
|close|PLCとの通信を終了させる|なし|

#### MCProtocol でのコマンド構成

設定にもよるが、原則コマンドはすべて16進数  
本プログラム内では read , write のファンクションを作成済みだが、他の処理が必要な場合は本節を参考にコマンドを作成し、send でPLCに送信すること

**コマンドの構成**

|No|項目|例|備考|
|:---:|:---|:---|:---|
|1|サブヘッダ|5000|固定値|
|2|ネットワーク番号|00|自局:0<br>他局:1～239|
|3|PC番号|FF|自局:255<br>他局:1～239|
|4|要求先ユニットI/O番号|03FF|自局CPU:1023<br>制御/待機CPU:976～979<br>マルチCPU:992～995<br>マルチドロップ接続上のC24の管理CPU:000～511|
|5|要求先ユニット局番号|00|マルチドロップ以外:0<br>マルチドロップ接続上の局:1～31|
|6|要求データ長	|0018|No7～No10までの桁数<br>※18の場合は24桁となる|
|7|CPU監視タイマ|0010|0:処理完了まで無限待ち<br>1～65535:処理完了まで値×250msの待ち|
|8|コマンド|0401<br>1401|1025:読み込み<br>5121:書き込み|
|9|サブコマンド|0000|コマンドによって異なる|
|10|デバイス|D*005602|デバイスの番号|
|11|取得するデータ件数|001E|取得するデータの件数|
|12|書き込む内容|00FF|書き込みの場合のみ利用|

